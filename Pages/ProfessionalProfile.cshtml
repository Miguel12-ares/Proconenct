@page
@model ProConnect.Pages.ProfessionalProfileModel
@{
    ViewData["Title"] = "Mi Perfil Profesional";
}

@section Styles {
    <link rel="stylesheet" href="~/css/professional-profile/main.css" />
}

<div class="professional-profile-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="professional-profile-card">
                    <div class="professional-profile-header">
                        <h1 class="professional-profile-title">
                            <i class="fas fa-user-tie"></i>
                            Mi Perfil Profesional
                        </h1>
                        <p class="professional-profile-subtitle">
                            Gestiona tu información profesional para conectar con clientes
                        </p>
                    </div>
                    
                    <div class="professional-profile-body">
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-circle"></i>
                                @Model.ErrorMessage
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                        {
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i>
                                @Model.SuccessMessage
                            </div>
                        }
                        
                        @if (Model.Profile != null)
                        {
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                Ya tienes un perfil profesional. Puedes editarlo a continuación.
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Aún no tienes un perfil profesional. Completa la información a continuación para crear tu perfil.
                            </div>
                        }

                        <form id="profileForm" method="post">
                            <div class="form-section">
                                <h5 class="form-section-title">
                                    <i class="fas fa-graduation-cap"></i>
                                    Información Básica
                                </h5>
                                
                                <div class="row">
                                    <!-- Especialidades -->
                                    <div class="col-md-6 mb-3">
                                        <label for="specialties" class="form-label">Especialidades *</label>
                                        <select id="specialties" name="Specialties" class="form-select specialties-select" multiple required>
                                            @{
                                                var specialtiesList = new List<string> {
                                                    "Derecho Laboral", "Derecho Civil", "Derecho Comercial", "Derecho Penal", "Derecho Administrativo",
                                                    "Contabilidad", "Auditoría", "Consultoría Empresarial", "Diseño Gráfico", "Desarrollo Web",
                                                    "Marketing Digital", "Psicología", "Medicina", "Ingeniería", "Arquitectura"
                                                };
                                                var selectedSpecialties = Model.Profile?.Specialties ?? new List<string>();
                                            }
                                            @foreach (var specialty in specialtiesList)
                                            {
                                                var isSelected = selectedSpecialties.Contains(specialty);
                                                if (isSelected)
                                                {
                                                    <option value="@specialty" selected>@specialty</option>
                                                }
                                                else
                                                {
                                                    <option value="@specialty">@specialty</option>
                                                }
                                            }
                                        </select>
                                        <div class="form-text">Selecciona al menos una especialidad. Mantén presionado Ctrl para seleccionar múltiples.</div>
                                    </div>

                                    <!-- Ubicación -->
                                    <div class="col-md-6 mb-3">
                                        <label for="location" class="form-label">Ubicación *</label>
                                        <input type="text" id="location" name="Location" class="form-control" 
                                               value="@Model.Profile?.Location" required 
                                               placeholder="Ej: Medellín, Colombia">
                                    </div>
                                </div>

                                <!-- Biografía -->
                                <div class="mb-3">
                                    <label for="bio" class="form-label">Biografía Profesional *</label>
                                    <textarea id="bio" name="Bio" class="form-control" rows="6" required
                                              placeholder="Describe tu experiencia, formación y enfoque profesional...">@Model.Profile?.Bio</textarea>
                                    <div class="form-text">Mínimo 100 caracteres. Describe tu experiencia y especialidades.</div>
                                    <div id="bioCounter" class="bio-counter"></div>
                                </div>

                                <div class="row">
                                    <!-- Años de Experiencia -->
                                    <div class="col-md-6 mb-3">
                                        <label for="experienceYears" class="form-label">Años de Experiencia</label>
                                        <input type="number" id="experienceYears" name="ExperienceYears" class="form-control" 
                                               value="@Model.Profile?.ExperienceYears" min="0" max="50">
                                    </div>

                                    <!-- Tarifa por Hora -->
                                    <div class="col-md-6 mb-3">
                                        <label for="hourlyRate" class="form-label">Tarifa por Hora (USD) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" id="hourlyRate" name="HourlyRate" class="form-control" 
                                                   value="@Model.Profile?.HourlyRate" min="1" max="10000" step="0.01" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h5 class="form-section-title">
                                    <i class="fas fa-certificate"></i>
                                    Credenciales y Estado
                                </h5>

                                <!-- Credenciales -->
                                <div class="mb-3">
                                    <label for="credentials" class="form-label">Credenciales</label>
                                    <textarea id="credentials" name="Credentials" class="form-control credentials-textarea" rows="3"
                                              placeholder="Ingresa tus títulos, certificaciones y credenciales (una por línea)">@(Model.Profile?.Credentials != null ? string.Join("\n", Model.Profile.Credentials) : "")</textarea>
                                    <div class="form-text">Ingresa una credencial por línea.</div>
                                </div>

                                <!-- Estado del Perfil -->
                                <div class="mb-3">
                                    <label for="status" class="form-label">Estado del Perfil</label>
                                    <select id="status" name="Status" class="form-select status-select">
                                        @{
                                            var status0Selected = Model.Profile?.Status == ProConnect.Application.DTOs.Shared.ProfileStatusDto.Draft;
                                            var status1Selected = Model.Profile?.Status == ProConnect.Application.DTOs.Shared.ProfileStatusDto.Active;
                                            var status2Selected = Model.Profile?.Status == ProConnect.Application.DTOs.Shared.ProfileStatusDto.Inactive;
                                        }
                                        @if (status0Selected)
                                        {
                                            <option value="0" selected>Borrador (No visible)</option>
                                        }
                                        else
                                        {
                                            <option value="0">Borrador (No visible)</option>
                                        }
                                        @if (status1Selected)
                                        {
                                            <option value="1" selected>Activo (Visible publicamente)</option>
                                        }
                                        else
                                        {
                                            <option value="1">Activo (Visible publicamente)</option>
                                        }
                                        @if (status2Selected)
                                        {
                                            <option value="2" selected>Inactivo</option>
                                        }
                                        else
                                        {
                                            <option value="2">Inactivo</option>
                                        }
                                    </select>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondary" onclick="history.back()">
                                    <i class="fas fa-arrow-left"></i> Volver
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <i class="fas fa-save"></i> 
                                    <span id="submitText">@(Model.Profile != null ? "Actualizar Perfil" : "Crear Perfil")</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Contador de caracteres para la biografía
        const bioTextarea = document.getElementById('bio');
        const bioCounter = document.getElementById('bioCounter');
        
        function updateBioCounter() {
            const length = bioTextarea.value.length;
            const minLength = 100;
            const remaining = minLength - length;
            
            if (length < minLength) {
                bioCounter.textContent = `Faltan ${remaining} caracteres (mínimo ${minLength})`;
                bioCounter.className = 'bio-counter danger';
            } else {
                bioCounter.textContent = `${length} caracteres (mínimo ${minLength})`;
                bioCounter.className = 'bio-counter success';
            }
        }
        
        bioTextarea.addEventListener('input', updateBioCounter);
        updateBioCounter();
        
        // Validación del formulario
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            const bio = bioTextarea.value.trim();
            const specialties = document.getElementById('specialties').selectedOptions;
            const location = document.getElementById('location').value.trim();
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
            
            let isValid = true;
            let errorMessage = '';
            
            // Validar biografía
            if (bio.length < 100) {
                errorMessage += 'La biografía debe tener al menos 100 caracteres.\n';
                isValid = false;
            }
            
            // Validar especialidades
            if (specialties.length === 0) {
                errorMessage += 'Debe seleccionar al menos una especialidad.\n';
                isValid = false;
            }
            
            // Validar ubicación
            if (location.length < 3) {
                errorMessage += 'La ubicación debe tener al menos 3 caracteres.\n';
                isValid = false;
            }
            
            // Validar tarifa
            if (hourlyRate <= 0 || hourlyRate > 10000) {
                errorMessage += 'La tarifa por hora debe estar entre $1 y $10,000.\n';
                isValid = false;
            }
            
            if (!isValid) {
                e.preventDefault();
                alert('Por favor corrige los siguientes errores:\n\n' + errorMessage);
            } else {
                // Mostrar estado de carga
                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                submitBtn.classList.add('loading');
                submitText.textContent = 'Guardando...';
                submitBtn.disabled = true;
            }
        });
    </script>
} 